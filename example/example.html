
<!-- saved from url=(0027)http://147.47.123.184:5910/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Bonobot</title>
  
  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="./Mock Dialogue1_files/jquery-3.2.1.min.js"></script>
  <!--Import Google Icon Font-->
  <link href="./Mock Dialogue1_files/icon" rel="stylesheet">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="./Mock Dialogue1_files/materialize.min.css">
  <!-- Compiled and minified Javascript -->
  <script src="./Mock Dialogue1_files/materialize.min.js"></script>
  
  <!-- for socketio -->
  <script type="text/javascript" src="./Mock Dialogue1_files/socket.io.min.js"></script>
  
  <!-- custom code load -->
	<script type="text/javascript" src="./Mock Dialogue1_files/elizabot.js"></script>
	<script type="text/javascript" src="./Mock Dialogue1_files/elizadata.js"></script>
  <script type="text/javascript" src="./Mock Dialogue1_files/d3.v4.min.js"></script>
  <script type="text/javascript" src="./Mock Dialogue1_files/index.js"></script>
  <script type="text/javascript" src="./Mock Dialogue1_files/phaseRule.js"></script>
  <!-- custom css는 가장 나중에 로드해야함 -->
  <link rel="stylesheet" href="./Mock Dialogue1_files/style.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body onload="bodyOnload()">
  <div class="row" id="chat">

  <div class="row" style="height:7.5%">
    <nav>
      <div class="nav-wrapper">
        <div class="col s2"><img src="./Mock Dialogue1_files/logo.png" style="height:100%"></div>
        <a class="logo" style="color:white">Bonobot<span id="phaseChecker" style="color: black;">.</span></a>
      </div>
    </nav>

    <!-- <div class="progress">
      <div class="determinate" id='pBar'></div>
    </div> -->
  </div>

  <div class="row" style="height:81%">
    <div class="col s12" id="eliza">
      <!-- chat plsplay -->      
      <div id="display"><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Welcome! What is your name?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">SoHyun</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Hi SoHyun! I'm BonoBot.</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Hi Bonobot!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I am a chatbot that listens to your stories and helps you guide yourself.</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">That's cool!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Everything you say in this chat will be kept secret, so no worries!</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Okay, I got it!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">If you're ready to talk, please type 'OK' to begin.</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">OK</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Great. Thank you for coming in today.</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">You're welcome!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What would you like to talk about?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I would like to talk about my graduate school life.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I see. Can you elaborate on that?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I don't know how I can manage my workload.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">You don't know how you can manage your workload.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What things make you feel that this is a problem?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I think I have too many things to do and catch up at once.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Right. I hear you.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What concerns do you have about that?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I am afraid I may not be able to produce good research results.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">That you feel afraid is understandable.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What worries about your current situation?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I don't have enough time for everything.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">You don't have enough time for everything. Hmm.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Hmm. No need to worry if you don't.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Do you wish to be able to have enough time for everything?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Yes I wish I had 48 hours!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">It is understandable that you wish to wish.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Many people wish as well.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Why do you want you had 48 hours?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Because I have so many things to do and 24 hours are not enough.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Possibly they are not enough.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Actually, I think you're already moving forward by talking about this.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Are you positive they are not enough?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">In fact, I am not sure...</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">It's understandable you think you are not sure.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I think you being not sure is just like others.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What is your best hope now?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">My hope is to be a competent researcher in my field.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I can tell. I've seen some stressed graduate students with similar problems.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Being a graduate student usually means a lot of stress and responsibilities.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">What will it be like when the problem is solved?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I think I will be with some quality published papers.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I see. you think will be with some quality published papers.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">I think you're on the right track.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">At this point, after reviewing all of this, what's the next step for you?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I think I have to focus on writing papers, instead of juggling with other chores.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Really?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">I think so</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">We encounter all kinds of issues in life.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">You know, they say action is the foundational key to success. So keep it up!</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Thanks!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Oops, but the time's almost up. We've got to wrap up our conversation today.</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Oh really?</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">So we talked about "your graduate school life" today. How do you feel after talking about it now?</div></div><div class="col s10 right"><div class="chip right userSay"><img src="./Mock Dialogue1_files/user_icon.png" alt="Contact Person">SoHyun</div><div class="col s12 right-align">Just a little bit better. I think I realized what my problem was.</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Good to know. Thank you for coming in today. Let's talk again soon!</div></div><div class="col s10"><div class="chip elizaSay"><img src="./Mock Dialogue1_files/chat_icon.png" alt="Contact Person">Bonobot</div><div class="col s12">Bonobot has left the chat.</div></div></div>
    </div>
  </div>
  
  <!-- user input -->
  <div class="row valign-wrapper input-field" id="inputWrapper" style="height:8%">
    <input class="col s10 offset-s1" id="input" type="text" autocomplete="off">
    <!-- <a class="waves-effect waves-light btn col s2" id="rcpBtn">send</a> -->
  </div>
</div>

  <!-- development log below here -->
<div class="container" id="dev" style="display: none">

  <label>request to front directly</label>
  <div class="row">
    <a class="waves-effect waves-light btn" id="rcpBtn">send to rcp</a>
    <a class="waves-effect waves-light btn" id="saveBtn">save dialogue</a>
  </div>

  <label>request to Flask server</label>
  <div class="row">
    <a class="waves-effect waves-light btn" id="saveMongo">save dialogue at mongo</a>
    <a class="waves-effect waves-light btn" id="classify">classify</a>
    <!-- <a class="waves-effect waves-light btn" id='saveSql'>save dialogue at sqlite</a> -->
  </div>

  <hr>
  <div class="row">
    <div class="col s6"><label>category</label><input id="label"></div>
    <div class="col s2"><label>phase</label><input id="phase"></div>
    <div class="col s4"><label>OCAR</label><input id="ocar"></div>
    <div class="col s12"><label>ocarMem</label><input id="ocarMem"></div>
    <div class="col s12"><label>pre input</label><input id="pre"></div>
    <div class="col s12"><label>modified input</label><input id="refine"></div>
  </div>

  <label>liwc top3 category</label>
  <div class="row">
    <div class="col s4"><input class="liwc"></div>
    <div class="col s4"><input class="liwc"></div>
    <div class="col s4"><input class="liwc"></div>
    <div class="liwc col s12" id="d3">
      <svg></svg>
    </div>
  </div>

</div>

<!-- js below here -->
<script language="Javascript" type="text/javascript" charset="utf-8">
  function bodyOnload(){
    if(devFlag){  // development mode
      devMode();
      // phaseState = 1;
      // oqCnt = 1;
    }
    window.setTimeout('elizaReset()',500);
    socket.emit('message', {data: '*****New client loged in.*****', type: 'notice'});
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  var eliza = new ElizaBot();
  var elizaLines = new Array();
  
  function elizaReset() {
    eliza.reset();
    elizaLines.length = 0;
    // elizadata.js load시간 조금 필요
    var g = guides[guideCnt];
    var balloon = makeBalloon(g, 0);
    document.getElementById('display').appendChild(balloon);
    guideCnt++;
    // sleep(200).then(elizaStep());
  }
  
  var input = document.getElementById('input');  
  var userLogMem = [];
  var elizaLogMem = [];
  var ctgMem = [];
  var removedRules = [];
  var cursor = 0;
  var endFlag = false;
  var timeoverFlag = false; // timeover시에 'O'만 뽑히도록 설정
  var guideCnt = 0;
  var oqCnt = 0;
  var endCnt = 0;
  var timeover; // timeoutID
  var input_pre; // timeout시에 이전 인풋값 저장한거 로드
  var domain; // liwc top3 cetegory 저장 array[3]
  var startTime = new Date();
  var endTime = new Date();
  var theme = 'Your concerns';
  
  // 이게 메인루프
  async function elizaStep() {
    var userinput = timeoverFlag? input_pre: input.value; input.value="";// 타임오버시 앞에 말 저장한거 불러오기 
    var userinput_modi;
    var display = document.getElementById('display');
    var rpl;
    var balloon;
    var balloon_u;
    var hasStop = new RegExp(/\.+$|\?+$/); // 마지막 마침표 물음표 다시 붙이기
    toggleProgress();    
/*
    // 마지막 마침표 물음표 찾기
    var temp_userinput = userinput.split(" ");
    var stop_res = [];
    temp_userinput.forEach(function(el,id){
      stop_res.push(hasStop.exec(el));
    });

    // refine 후 차트그리기 후 transform
    var sentense_all;
    reqRefine(userinput)
        .then(sentense_modi=>{
          // 마지막 마침표 물음표 다시 붙이기
          var temp_sentense_modi = sentense_modi.split(" ");
          temp_sentense_modi.forEach(function(el,id){
            if(temp_sentense_modi.length == stop_res.length){
              if(stop_res[id]){
                temp_sentense_modi[id] = el+stop_res[id][0];
              }
            }
          });
          userinput_modi = temp_sentense_modi.join(" ");
          userinput_modi = sentense_modi;
          
          document.getElementById('refine').value = userinput_modi;
          console.log('before:',userinput,'\nRefined:',userinput_modi);

          sentense_all = userLogMem.join('. ');          
        })
        .then(afterAsync)
        .then(()=>{postContents(sentense_all);})
        .then(res=>{drawChart(res.receptiviti_scores.percentiles);})
        .catch(err=>console.error(err));
*/
      
  // 현재 리파이너리, liwc 전부 사용 안함.. 리파이너리 사용하려면 수정 전과 특수문자 맞추기 등 대대적 공사 필요
  // 인풋 ()포획은 잘 되나 단일 오타 체크 기능 버림 
    afterAsync();
    
    function afterAsync(){
      if (userinput != '') {
        // 대화 문장 수로 Phase 체크 후 변경
        checkPhase(elizaLogMem.length);
        document.getElementById('phase').value = phaseState;
        // 페이즈룰 적용
        if(phaseState==0){
          if(guides[guideCnt] && guides[guideCnt].indexOf('@')>-1){
            // 이름설정
            startTime = new Date();
            var u = userinput.split(' ');
            user = /\w/.test(u[u.length-1])? u[u.length-1]: u[u.length-2]; // 혹시나 마지막에 특수문자 있을까 거름
            user = user.replace(/\.$/, ''); 
            user = user[0].toUpperCase() + user.slice(1);
            guides[guideCnt] = guides[guideCnt].replace('@', user);          
          }
          // please type “OK”.
          if(guideCnt==guides.length-1){
            if(userinput.toLowerCase().indexOf('ok')>-1) phaseState = 1;
            else{
              toggleProgress();
              input.focus();
              return;
            }
          }
          rpl = guides[guideCnt];
          balloon =makeBalloon(rpl,0);
          guideCnt++;
        }
        else if(phaseState==1){
          if(oqCnt==oqs.length-1){  // talking about?
            theme = userinput;
            theme = theme.replace(/\W+$/g, ''); // \\?, really\\? 걸리는데서 안빠지게 특수문자 제거
            var re = new RegExp(/about\s?/i); // about 뒤에 글만 살림
            var mdl = re.exec(theme);
            if(mdl) theme = theme.substr(mdl[0].length + mdl['index']);
          }
          rpl = oqs[oqCnt];
          balloon =makeBalloon(rpl,0);
          oqCnt++;
        }
        else if(phaseState==2 || phaseState==3){
          rpl = eliza.transform(userinput);
          console.log(rpl);
          balloon =makeBalloon(rpl,0);                
        }
        else if(phaseState==4){
          //ending with Affirmation
          if(ocarMem[ocarMem.length-1]==2) endFlag=true;

          if(endFlag){
            rpl = ends[endCnt]? ends[endCnt]:'Bonobot has left the chat.';
            // final summary
            if(ends[endCnt] && ends[endCnt].indexOf('@')>-1){
              console.log(theme);
              theme = eliza.transform("afghans "+theme);
              theme = theme[0].toLowerCase() + theme.substr(1); // 맨처음 소문자              
              console.log(theme);              
              rpl = rpl.replace('@', theme);
              // rpl = rpl.replace(/about \"about/i, 'about "');
            }
            balloon =makeBalloon(rpl,0);          
            // 대화 끝나면 자동 저장
            if(endCnt == ends.length){
              endTime = new Date();
              reqSaveMongo().then(res=>console.log('### Sucessfully saved to mongoDB: ',res,'###'));
            }
            endCnt++; 
          }
          else{
            rpl = eliza.transform(userinput);
            console.log(rpl);
            balloon = makeBalloon(rpl,0);          
          }
        }  

        // // classify OQ guide dialogues
        // if(userLogMem.length == oqs.length){
        //   // 전체 대화로 분류
        //   eliza.category = getCategory(userLogMem);
        // }

        // 메모리에 대화 기록  
        if(!timeoverFlag){ // 자동으로 넘어갈땐 렌더링 안함
          userLogMem.push(userinput);
          getCategory([userinput]);

          cursor=userLogMem.length;
          // user balloon 렌더링        
          elizaLines.push(user+': '+userinput);
          balloon_u = makeBalloon(userinput,1);
          display.appendChild(balloon_u);        
        }
        elizaLines.push('Bonobot: '+rpl);
        elizaLogMem.push(rpl);

        // loader 렌더링
        setTimeout(function(){
          var loader = makeBalloon(null, 2);
          display.appendChild(loader);
          display.scrollTop = display.scrollHeight; // 마지막 대화로 스크롤 내리기           
        },500);
        // eliza balloon 렌더링
        setTimeout(function(){
          display.removeChild(document.getElementById('loader'));
          display.appendChild(balloon);
          toggleProgress();
          display.scrollTop = display.scrollHeight; // 마지막 대화로 스크롤 내리기        
        },elizaDelay);
      }
      if(!timeoverFlag) input_pre = userinput;  // phase4 연속 자동 생성 위해서
      document.getElementById('ocarMem').value = ocarMem.join(' ');
      document.getElementById('pre').value = input_pre;

      input.focus();
      display.scrollTop = display.scrollHeight; // 마지막 대화로 스크롤 내리기 
      // control timeover differently according to phase           
      if(phaseState==2 || phaseState==3){
        if(ocarMem[ocarMem.length-1]==2 || ocarMem[ocarMem.length-1]==3) timeCheck(userDelay); // AR -> OC
      }
      else if(phaseState==4 && endCnt<=2 && ocarMem[ocarMem.length-1]>=2) timeCheck(userDelay);
      else if(phaseState==4 && endCnt==4) timeCheck(userDelay);
      console.log('=================================');
    }
  }

  // user 답변 없으면 시간체크 후 엘리자 한번 더 말하기
  function timeCheck(sec){
    console.log('TIMECHECK STARTED');
    timeover = setTimeout(function(){
      console.log('~~~~~~TIME OVER~~~~~');
      var temp = input.value;
      timeoverFlag = true;
      elizaStep()
      input.value = temp;
    }, sec);
  }

// ----------- code for UI by Cockroach -----------
  input.addEventListener('keydown', function(e){
    if(timeover){
      window.clearTimeout(timeover);
      timeoverFlag = false;
      console.log("TIMECHECK STOPPED");
    }  
  });

  input.addEventListener('keyup', function(e){
    // if(!timeover) timeCheck(7000);
    // console.log(e.keyCode);
    if(e.keyCode === 38 && cursor>0){
      cursor--;
      e.target.value = userLogMem[cursor]; // cursor = userLogMem.length
    }
    else if(e.keyCode === 40 && cursor<userLogMem.length-1){
      cursor++;
      e.target.value = userLogMem[cursor]; // cursor = userLogMem.length
    }
    else if(e.keyCode === 13){
      if(input.value!="") elizaStep();
    }
  });

  input.addEventListener('focusout', function(e){
    cursor = userLogMem.length;
  });

// ------------
  // document.getElementById('rcpBtn').addEventListener('click', function(e){
  //   var sentense = userLogMem.join('. ');
  //   console.log('All sentense:',sentense);
  //   postContents(sentense).then(res=>drawChart(res.receptiviti_scores.percentiles));
  // });

  // deprecated
  // document.getElementById('saveBtn').addEventListener('click', function(e){
  //   var sentense = userLogMem.join('. ');
  //   console.log('All sentense:',sentense);
  //   postContents(sentense).then(res=>drawChart(res.receptiviti_scores.percentiles));
  // });

// -------------
  document.getElementById('saveMongo').addEventListener('click', function(e){
    console.log('clicked saveMongo btn');
    // var sentense = userLogMem.join('. ');
    reqSaveMongo().then(res=>console.log('Sucessfully saved to mongoDB: ',res));
  });

  // document.getElementById('saveSql').addEventListener('click', function(e){
  //   console.log('clicked saveSql btn');
  // });

  document.getElementById('classify').addEventListener('click', function(e){
    console.log('clicked classify btn');
    // 전체 대화내용에 관해 분류
    getCategory(userLogMem); 
  });

  function getCategory(userLogMem){
    reqClassify(userLogMem)
      .then(res=>{
            res = res*1;  // str -> int
            console.log('*****Dialog is classified as:',res,'*****');      
            var label = document.getElementById('label');
            // eliza.category = res; // 아직 분류값 반영 중지
            if(res == 0) _res = 'Emotional';
            else if(res == 1) _res = 'Infomational';
            else  _res = 'Others';
            label.value = _res;
            ctgMem.push(_res);
            return res;
      })
      .catch(err=>console.error(err));
  }

  //dev cheatkey
  document.querySelector('a.logo').addEventListener('click', function(){
    devMode();
    setEliza(4-(guides.length + oqs.length),4,1);
    phaseState = 2;
    elizaDelay=1000;
    input.focus();
  });
</script>


<div class="hiddendiv common"></div><div id="weava-permanent-marker" date="1523260455075"></div><div id="weava-ui-wrapper"><div class="weava-drop-area-wrapper"><div class="weava-drop-area"></div>
</div></div></body></html>